{% extends 'base.html' %}
{% block title %}Report - Crime RD{% endblock %}

{% block content %}
<section class="hero-section d-flex justify-content-center align-items-center" id="section_1">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-12 mx-auto">
                <h1 class="text-white text-center">File a Cyber Crime Report</h1>
                <h6 class="text-center">Please fill out the form below to report an incident.</h6>
            </div>
        </div>
    </div>
</section>

<section class="section-padding">
    <div class="container">
        <div class="row g-4">
            <div class="col-lg-5 col-12">
                <div class="p-4 rounded-3 shadow-lg" style="background: #ffffff;">
                    <h2 class="mb-4 fw-bold" style="color: black;">Reporting Checklist</h2>
                    <div class="accordion" id="checklistAccordion">
                        <div class="accordion-item mb-2 border-0 shadow-sm rounded">
                            <h2 class="accordion-header" id="headingOne">
                                <button class="accordion-button fw-semibold" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">Before Reporting</button>
                            </h2>
                            <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#checklistAccordion">
                                <div class="accordion-body">
                                    <ul class="list-unstyled ms-2">
                                        <li>• Identify the type of crime</li>
                                        <li>• Gather evidence (screenshots, emails)</li>
                                        <li>• Note down the timeline of events</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item mb-2 border-0 shadow-sm rounded">
                            <h2 class="accordion-header" id="headingTwo">
                                <button class="accordion-button collapsed fw-semibold" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">While Filing</button>
                            </h2>
                            <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#checklistAccordion">
                                <div class="accordion-body">
                                    <ul class="list-unstyled ms-2">
                                        <li>• Describe the incident clearly</li>
                                        <li>• Upload evidence documents</li>
                                        <li>• Provide suspect info (if known)</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item mb-2 border-0 shadow-sm rounded">
                            <h2 class="accordion-header" id="headingThree">
                                <button class="accordion-button collapsed fw-semibold" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">After Reporting</button>
                            </h2>
                            <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#checklistAccordion">
                                <div class="accordion-body">
                                    <ul class="list-unstyled ms-2">
                                        <li>• Save your report Tracking ID</li>
                                        <li>• Follow up if needed</li>
                                        <li>• Update passwords & enable 2FA</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-7 col-12">
                <div style="background-color: #f0f8ff; padding: 20px; border-radius: 10px;">
                    <h2 class="text-center">Cyber Crime Case Filing Form</h2>
                    <form method="post" class="contact-form" id="report_form" enctype="multipart/form-data">
                        <div class="mb-3 text-center">
                            <label class="form-check-label"><input type="radio" class="form-check-input" name="registration_type" value="anonymous" id="anonymous_radio" checked> Anonymous Report</label>
                            <label class="form-check-label ms-3"><input type="radio" class="form-check-input" name="registration_type" value="registered" id="registered_radio"> Report with Details</label>
                        </div>

                        <div id="personal_detail_fields" style="display: none;">
                            <div class="mb-3"><label for="name" class="form-label">Your Name</label><input type="text" class="form-control rounded-input" id="name" name="name"></div>
                            <div class="mb-3"><label for="email" class="form-label">Your Email</label><input type="email" class="form-control rounded-input" id="email" name="email"></div>
                            <div class="mb-3"><label for="mobile" class="form-label">Mobile Number</label><input type="tel" class="form-control rounded-input" id="mobile" name="mobile"></div>
                            <div class="mb-3">
                                <label for="gender" class="form-label">Gender</label>
                                <select class="form-select rounded-input" id="gender" name="gender">
                                    <option value="" disabled selected>Select a Gender</option>
                                    <option value="male">Male</option><option value="female">Female</option><option value="other">Other</option>
                                </select>
                            </div>
                            <div class="mb-3"><label for="age" class="form-label">Your Age</label><input type="number" class="form-control rounded-input" id="age" name="age" min="0" max="120"></div>
                        </div>

                        <div class="mb-3">
                            <label for="state" class="form-label">State</label>
                            <select class="form-select rounded-input" id="state" name="state" required>
                                <option value="" disabled selected>Select a state</option>
                                <option value="Andhra Pradesh">Andhra Pradesh</option><option value="Arunachal Pradesh">Arunachal Pradesh</option><option value="Assam">Assam</option><option value="Bihar">Bihar</option><option value="Chhattisgarh">Chhattisgarh</option><option value="Goa">Goa</option><option value="Gujarat">Gujarat</option><option value="Haryana">Haryana</option><option value="Himachal Pradesh">Himachal Pradesh</option><option value="Jharkhand">Jharkhand</option><option value="Karnataka">Karnataka</option><option value="Kerala">Kerala</option><option value="Madhya Pradesh">Madhya Pradesh</option><option value="Maharashtra">Maharashtra</option><option value="Manipur">Manipur</option><option value="Meghalaya">Meghalaya</option><option value="Mizoram">Mizoram</option><option value="Nagaland">Nagaland</option><option value="Odisha">Odisha</option><option value="Punjab">Punjab</option><option value="Rajasthan">Rajasthan</option><option value="Sikkim">Sikkim</option><option value="Tamil Nadu">Tamil Nadu</option><option value="Telangana">Telangana</option><option value="Tripura">Tripura</option><option value="Uttar Pradesh">Uttar Pradesh</option><option value="Uttarakhand">Uttarakhand</option><option value="West Bengal">West Bengal</option>
                            </select>
                        </div>
                        <div class="mb-3"><label for="location" class="form-label">Location of Incident</label><input type="text" class="form-control rounded-input" id="location" name="location" required></div>
                        <div class="mb-3"><label for="date" class="form-label">Date of Incident</label><input type="date" class="form-control rounded-input" id="date" name="date" required></div>
                        <div class="mb-3"><label for="description" class="form-label">Description of Incident</label><textarea class="form-control rounded-input" id="description" name="description" rows="5" required></textarea></div>
                        <div class="mb-3"><label for="evidence_file" class="form-label">Upload Evidence</label><input type="file" class="form-control rounded-input" id="evidence_file" name="evidence_file" required></div>
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="agreementCheck" name="agreement" required>
                            <label class="form-check-label" for="agreementCheck">I agree that the incident reported and submitted evidence are genuine.</label>
                        </div>
                        
                        <div class="g-recaptcha" data-sitekey="6Lea4tsrAAAAAIPHCHVGzadNqwSufe_pfzFNSiQz" required></div>
                        {% if captcha_error %}<div class="alert alert-danger mt-3">{{ captcha_error }}</div>{% endif %}
                        
                        <div class="d-flex justify-content-center mt-3">
                            <button type="submit" class="btn btn-primary btn-lg" id="submit_report_button">Send Report</button>
                        </div>
                    </form>

                    {% if success %}
                    <div class="alert alert-success mt-3">
                        {{ success }}
                        {% if tracking_id %}<br><p class="mb-0"><a href="{{ url_for('download_receipt', report_tracking_id=tracking_id) }}" class="alert-link" target="_blank">Download your report receipt (PDF)</a></p>{% endif %}
                    </div>
                    {% endif %}
                    {% if error %}<div class="alert alert-danger mt-3">{{ error }}</div>{% endif %}
                </div>
            </div>
        </div>
    </div>
</section>

<script src="https://www.google.com/recaptcha/api.js" async defer></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const anonymousRadio = document.getElementById('anonymous_radio');
        const registeredRadio = document.getElementById('registered_radio');
        const personalDetailFields = document.getElementById('personal_detail_fields');
        const submitButton = document.getElementById('submit_report_button');
        const fields = [
            document.getElementById('name'), document.getElementById('email'), document.getElementById('mobile'),
            document.getElementById('gender'), document.getElementById('age')
        ];

        function toggleFields() {
            const isAnonymous = anonymousRadio.checked;
            personalDetailFields.style.display = isAnonymous ? 'none' : 'block';
            fields.forEach(field => {
                if (isAnonymous) {
                    field.removeAttribute('required');
                    field.setAttribute('disabled', 'true');
                    field.value = ''; 
                } else {
                    field.setAttribute('required', '');
                    field.removeAttribute('disabled');
                }
            });
        }

        anonymousRadio.addEventListener('change', toggleFields);
        registeredRadio.addEventListener('change', toggleFields);
        toggleFields(); // Initial call
    });
</script>
{% endblock %}